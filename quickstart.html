
<!DOCTYPE html>

<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
<meta charset="utf-8"/>
<meta content="Docutils 0.19: https://docutils.sourceforge.io/" name="generator">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Quickstart — TorchUncertainty 0.2.2.post0 documentation</title>
<link href="_static/images/logo_torch_uncertainty.png" rel="shortcut icon"/>
<link href="_static/css/custom.css" rel="stylesheet" type="text/css"/>
<!-- <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> -->
<link href="_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="_static/css/custom.css" rel="stylesheet" type="text/css"/>
<link href="_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="_static/sphinx-codeautolink.css" rel="stylesheet" type="text/css"/>
<link href="_static/sg_gallery.css" rel="stylesheet" type="text/css"/>
<link href="_static/sg_gallery-binder.css" rel="stylesheet" type="text/css"/>
<link href="_static/sg_gallery-dataframe.css" rel="stylesheet" type="text/css"/>
<link href="_static/sg_gallery-rendered-html.css" rel="stylesheet" type="text/css"/>
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="auto_tutorials/index.html" rel="next" title="Tutorials"/>
<link href="installation.html" rel="prev" title="Installation"/>
<!-- Google Analytics -->
<script type="text/javascript">
    var collapsedSections = [];
  </script>
<!-- End Google Analytics -->
<script src="_static/js/modernizr.min.js"></script>
<script>
    MathJax = {
        chtml: {
            scale: 1,
            minScale: 1,
        },
        svg: {
            scale: 1,
            minScale: 1,
        }
    }
</script>
<!-- Preload the theme fonts -->
<link as="font" crossorigin="anonymous" href="_static/fonts/FreightSans/freight-sans-book.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="_static/fonts/FreightSans/freight-sans-medium.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="_static/fonts/FreightSans/freight-sans-bold.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="_static/fonts/FreightSans/freight-sans-medium-italic.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" rel="preload" type="font/woff2"/>
<!-- Preload the katex fonts -->
<link as="font" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" rel="preload" type="font/woff2"/>
<link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" rel="stylesheet"/>
</meta></head>
<div class="container-fluid header-holder tutorials-header" id="header-holder">
<div class="container">
<div class="header-container">
<a aria-label="OpenMMLab" class="header-logo" href="https://torch-uncertainty.github.io/"></a>
<div class="main-menu">
<ul>
<li>
<a href="https://github.com/ENSTA-U2IS-AI/torch-uncertainty" target="_blank">GitHub</a>
</li>
</ul>
</div>
<a class="main-menu-open-button" data-behavior="open-mobile-menu" href="#"></a>
</div>
</div>
</div>
<body class="pytorch-body">
<div class="table-of-contents-link-wrapper">
<span>Table of Contents</span>
<a class="toggle-table-of-contents" data-behavior="toggle-table-of-contents" href="#"></a>
</div>
<nav class="pytorch-left-menu" data-toggle="wy-nav-shift" id="pytorch-left-menu">
<div class="pytorch-side-scroll">
<div aria-label="main navigation" class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation">
<div class="pytorch-left-menu-search">
<div role="search">
<form action="search.html" class="wy-form" id="rtd-search-form" method="get">
<input name="q" placeholder="Search Docs" type="text"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
</div>
</div>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_guide.html">CLI Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>
</div>
</div>
</nav>
<div class="pytorch-container">
<div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
<div class="pytorch-breadcrumbs-wrapper">
<div aria-label="breadcrumbs navigation" role="navigation">
<ul class="pytorch-breadcrumbs">
<li>
<a href="index.html">
        Docs
      </a> &gt;
    </li>
<li>Quickstart</li>
<!-- 
    <li class="pytorch-breadcrumbs-aside">
      
      
      
      
      
      <a href="/zh_CN//quickstart.html" class="fa fa-language"> 以中文阅读</a>
      
      
    </li>
    
     -->
</ul>
</div>
</div>
<div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
        Shortcuts
      </div>
</div>
<section class="pytorch-content-wrap" data-toggle="wy-nav-shift" id="pytorch-content-wrap">
<div class="pytorch-content-left">
<div class="pytorch-call-to-action-links">
<div id="tutorial-type">quickstart</div>
<!-- <div id="google-colab-link">
            <img class="call-to-action-img" src="_static/images/pytorch-colab.svg" />
            <div class="call-to-action-desktop-view">Run in Google Colab</div>
            <div class="call-to-action-mobile-view">Colab</div>
          </div> -->
<div id="download-notebook-link">
<img class="call-to-action-notebook-img" src="_static/images/pytorch-download.svg"/>
<div class="call-to-action-desktop-view">Download Notebook</div>
<div class="call-to-action-mobile-view">Notebook</div>
</div>
<div id="github-view-link">
<img class="call-to-action-img" src="_static/images/pytorch-github.svg"/>
<div class="call-to-action-desktop-view">View on GitHub</div>
<div class="call-to-action-mobile-view">GitHub</div>
</div>
</div>
<div class="rst-content">
<div class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<article class="pytorch-article" id="pytorch-article" itemprop="articleBody">
<section id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this heading">¶</a></h1>
<p>TorchUncertainty is centered around <strong>uncertainty-aware</strong> training and evaluation routines.
These routines make it very easy to:</p>
<ul class="simple">
<li><p>train ensembles-like methods (Deep Ensembles, Packed-Ensembles, MIMO, Masksembles, etc)</p></li>
<li><p>compute and monitor uncertainty metrics: calibration, out-of-distribution detection, proper scores, grouping loss, etc.</p></li>
<li><p>leverage calibration methods automatically during evaluation</p></li>
</ul>
<p>Yet, we take account that their will be as many different uses of TorchUncertainty as there are of users.
This page provides ideas on how to benefit from TorchUncertainty at all levels: from ready-to-train lightning-based models to using only specific
PyTorch layers.</p>
<figure class="figure-caption align-center" id="id5">
<a class="reference internal image-reference" href="_images/structure_torch_uncertainty.jpg"><img alt="TorchUncertainty structure" src="_images/structure_torch_uncertainty.jpg" style="width: 70%;"/></a>
<figcaption>
<p><span class="caption-text"><strong>Structure of TorchUncertainty</strong></span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<section id="training-with-torchuncertainty-s-uncertainty-aware-routines">
<h2>Training with TorchUncertainty’s Uncertainty-aware Routines<a class="headerlink" href="#training-with-torchuncertainty-s-uncertainty-aware-routines" title="Permalink to this heading">¶</a></h2>
<p>TorchUncertainty provides a set of Ligthning training and evaluation routines that wrap PyTorch models. Let’s have a look at the
<a class="reference external" href="https://github.com/ENSTA-U2IS-AI/torch-uncertainty/blob/main/torch_uncertainty/routines/classification.py">Classification routine</a>
and its parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightning.pytorch</span> <span class="kn">import</span> <span class="n">LightningModule</span>

<span class="k">class</span> <span class="nc">ClassificationRoutine</span><span class="p">(</span><span class="n">LightningModule</span><span class="p">):</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">loss</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
    <span class="n">num_estimators</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">format_batch_fn</span><span class="p">:</span> <span class="n">nn</span><span class="o">.</span><span class="n">Module</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">optim_recipe</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">Optimizer</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="c1"># ...</span>
    <span class="n">eval_ood</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">eval_grouping_loss</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ood_criterion</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
      <span class="s2">"msp"</span><span class="p">,</span> <span class="s2">"logit"</span><span class="p">,</span> <span class="s2">"energy"</span><span class="p">,</span> <span class="s2">"entropy"</span><span class="p">,</span> <span class="s2">"mi"</span><span class="p">,</span> <span class="s2">"vr"</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s2">"msp"</span><span class="p">,</span>
    <span class="n">log_plots</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">save_in_csv</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">calibration_set</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">"val"</span><span class="p">,</span> <span class="s2">"test"</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
  <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>
</pre></div>
</div>
<section id="building-your-first-routine">
<h3>Building your First Routine<a class="headerlink" href="#building-your-first-routine" title="Permalink to this heading">¶</a></h3>
<p>This routine is a wrapper of any custom or TorchUncertainty classification model. To use it,
just build your model and pass it to the routine as argument along with an optimization recipe
and the loss as well as the number of classes that we use for torch metrics.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">optim</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">routine</span> <span class="o">=</span> <span class="n">ClassificationRoutine</span><span class="p">(</span>
  <span class="n">model</span><span class="p">,</span>
  <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
  <span class="n">loss</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">(),</span>
  <span class="n">optim_recipe</span><span class="o">=</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="training-with-the-routine">
<h3>Training with the Routine<a class="headerlink" href="#training-with-the-routine" title="Permalink to this heading">¶</a></h3>
<p>To train with this routine, you will first need to create a lightning Trainer and have either a lightning datamodule
or PyTorch dataloaders. When benchmarking models, we advise to use lightning datamodules that will automatically handle
train/val/test splits, out-of-distribution detection and dataset shift. For this example, let us use TorchUncertainty’s
CIFAR10 datamodule.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch_uncertainty.datamodules</span> <span class="kn">import</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.datamodules.CIFAR10DataModule.html#torch_uncertainty.datamodules.CIFAR10DataModule" title="torch_uncertainty.datamodules.classification.cifar10.CIFAR10DataModule"><span class="n">CIFAR10DataModule</span></a>
<span class="kn">from</span> <span class="nn">lightning.pytorch</span> <span class="kn">import</span> <span class="n">Trainer</span>

<a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.datamodules.CIFAR10DataModule.html#torch_uncertainty.datamodules.CIFAR10DataModule" title="torch_uncertainty.datamodules.classification.cifar10.CIFAR10DataModule"><span class="n">dm</span></a> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.datamodules.CIFAR10DataModule.html#torch_uncertainty.datamodules.CIFAR10DataModule" title="torch_uncertainty.datamodules.classification.cifar10.CIFAR10DataModule"><span class="n">CIFAR10DataModule</span></a><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s2">"data"</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span><span class="n">gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">routine</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.datamodules.CIFAR10DataModule.html#torch_uncertainty.datamodules.CIFAR10DataModule" title="torch_uncertainty.datamodules.classification.cifar10.CIFAR10DataModule"><span class="n">dm</span></a><span class="p">)</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">routine</span><span class="p">,</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.datamodules.CIFAR10DataModule.html#torch_uncertainty.datamodules.CIFAR10DataModule" title="torch_uncertainty.datamodules.classification.cifar10.CIFAR10DataModule"><span class="n">dm</span></a><span class="p">)</span>
</pre></div>
</div>
<p>Here it is, you have trained your first model with TorchUncertainty! As a result, you will get access to various metrics
measuring the ability of your model to handle uncertainty. You can get other examples of training with lightning Trainers
looking at the <a class="reference external" href="tutorials.html#layers">Tutorials</a>.</p>
</section>
<section id="more-metrics">
<h3>More metrics<a class="headerlink" href="#more-metrics" title="Permalink to this heading">¶</a></h3>
<p>With TorchUncertainty datamodules, you can easily test models on out-of-distribution datasets, by
setting the <code class="docutils literal notranslate"><span class="pre">eval_ood</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code>. You can also evaluate the grouping loss by setting <code class="docutils literal notranslate"><span class="pre">eval_grouping_loss</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
Finally, you can calibrate your model using the <code class="docutils literal notranslate"><span class="pre">calibration_set</span></code> parameter. In this case, you will get
metrics for but the uncalibrated and calibrated models: the metrics corresponding to the temperature scaled
model will begin with <code class="docutils literal notranslate"><span class="pre">ts_</span></code>.</p>
</section>
</section>
<hr class="docutils"/>
<section id="using-the-lightning-cli-tool">
<h2>Using the Lightning CLI tool<a class="headerlink" href="#using-the-lightning-cli-tool" title="Permalink to this heading">¶</a></h2>
<section id="procedure">
<h3>Procedure<a class="headerlink" href="#procedure" title="Permalink to this heading">¶</a></h3>
<p>The library leverages the <a class="reference external" href="https://lightning.ai/docs/pytorch/stable/cli/lightning_cli.html">Lightning CLI tool</a>
to provide a simple way to train models and evaluate them, while insuring reproducibility via configuration files.
Under the <code class="docutils literal notranslate"><span class="pre">experiment</span></code> folder, you will find scripts for the three application tasks covered by the library:
classification, regression and segmentation. Take the most out of the CLI by checking our <a class="reference external" href="cli_guide.html">CLI Guide</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In particular, the <code class="docutils literal notranslate"><span class="pre">experiments/classification</span></code> folder contains scripts to reproduce the experiments covered
in the paper: <em>Packed-Ensembles for Efficient Uncertainty Estimation</em>, O. Laurent &amp; A. Lafage, et al., in ICLR 2023.</p>
</div>
</section>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h3>
<p>Training a model with the Lightning CLI tool is as simple as running the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># in torch-uncertainty/experiments/classification/cifar10</span>
<span class="n">python</span> <span class="n">resnet</span><span class="o">.</span><span class="n">py</span> <span class="n">fit</span> <span class="o">--</span><span class="n">config</span> <span class="n">configs</span><span class="o">/</span><span class="n">resnet18</span><span class="o">/</span><span class="n">standard</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>Which trains a classic ResNet18 model on CIFAR10 with the settings used in the Packed-Ensembles paper.</p>
</section>
</section>
<hr class="docutils"/>
<section id="using-the-pytorch-based-models">
<h2>Using the PyTorch-based models<a class="headerlink" href="#using-the-pytorch-based-models" title="Permalink to this heading">¶</a></h2>
<section id="id1">
<h3>Procedure<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h3>
<p>If you prefer classic PyTorch pipelines, we provide PyTorch Modules that do not
require Lightning.</p>
<ol class="arabic simple">
<li><p>Check the API reference under the <em>Models</em> section to ensure the architecture of your choice is supported by the library.</p></li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> in your training/testing script using one of the provided building functions listed in the API reference.</p></li>
</ol>
</section>
<section id="id2">
<h3>Example<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h3>
<p>You can initialize a Packed-Ensemble out of a ResNet18
backbone with the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">torch_uncertainty.models.resnet</span> <span class="kn">import</span> <span class="n">packed_resnet</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">packed_resnet</span><span class="p">(</span>
    <span class="n">in_channels</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">arch</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
    <span class="n">num_estimators</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils"/>
<section id="using-the-pytorch-based-layers">
<h2>Using the PyTorch-based layers<a class="headerlink" href="#using-the-pytorch-based-layers" title="Permalink to this heading">¶</a></h2>
<section id="id3">
<h3>Procedure<a class="headerlink" href="#id3" title="Permalink to this heading">¶</a></h3>
<p>It is likely that your desired architecture is not supported by our library.
In that case, you might be interested in directly using the actual layers.</p>
<ol class="arabic simple">
<li><p>Check the API reference for specific layers of your choosing.</p></li>
<li><p>Import the layers and use them as you would for any standard PyTorch layer.</p></li>
</ol>
<p>If you think that your architecture should be added to the package, raise an
issue on the GitHub repository!</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Do not hesitate to go to the <a class="reference external" href="api.html#layers">API Reference</a> to get better explanations on the
layer usage.</p>
</div>
</section>
<section id="id4">
<h3>Example<a class="headerlink" href="#id4" title="Permalink to this heading">¶</a></h3>
<p>You can create a Packed-Ensemble <code class="docutils literal notranslate"><span class="pre">torch.nn.Module</span></code> model with the following
code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">einops</span> <span class="kn">import</span> <span class="n">rearrange</span>
<span class="kn">from</span> <span class="nn">torch_uncertainty.layers</span> <span class="kn">import</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.layers.PackedConv2d.html#torch_uncertainty.layers.PackedConv2d" title="torch_uncertainty.layers.packed.PackedConv2d"><span class="n">PackedConv2d</span></a><span class="p">,</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.layers.PackedLinear.html#torch_uncertainty.layers.PackedLinear" title="torch_uncertainty.layers.packed.PackedLinear"><span class="n">PackedLinear</span></a>

<span class="k">class</span> <span class="nc">PackedNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">M</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.layers.PackedConv2d.html#torch_uncertainty.layers.PackedConv2d" title="torch_uncertainty.layers.packed.PackedConv2d"><span class="n">PackedConv2d</span></a><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">num_estimators</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.layers.PackedConv2d.html#torch_uncertainty.layers.PackedConv2d" title="torch_uncertainty.layers.packed.PackedConv2d"><span class="n">PackedConv2d</span></a><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">num_estimators</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.layers.PackedLinear.html#torch_uncertainty.layers.PackedLinear" title="torch_uncertainty.layers.packed.PackedLinear"><span class="n">PackedLinear</span></a><span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">num_estimators</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.layers.PackedLinear.html#torch_uncertainty.layers.PackedLinear" title="torch_uncertainty.layers.packed.PackedLinear"><span class="n">PackedLinear</span></a><span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">num_estimators</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc3</span> <span class="o">=</span> <a class="sphinx-codeautolink-a" href="generated/torch_uncertainty.layers.PackedLinear.html#torch_uncertainty.layers.PackedLinear" title="torch_uncertainty.layers.packed.PackedLinear"><span class="n">PackedLinear</span></a><span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">num_estimators</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num_estimators</span> <span class="o">=</span> <span class="n">M</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">rearrange</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="s2">"e (m c) h w -&gt; (m e) c h w"</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_estimators</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="n">packed_net</span> <span class="o">=</span> <span class="n">PackedNet</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<hr class="docutils"/>
<section id="other-usage">
<h2>Other usage<a class="headerlink" href="#other-usage" title="Permalink to this heading">¶</a></h2>
<p>Feel free to use any classes described in the API reference such as the metrics, datasets, etc.</p>
</section>
</section>
</article>
</div>
<footer>
<div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
<a accesskey="n" class="btn btn-neutral float-right" href="auto_tutorials/index.html" rel="next" title="Tutorials">Next <img class="next-page" src="_static/images/chevron-right-teal.svg"/></a>
<a accesskey="p" class="btn btn-neutral" href="installation.html" rel="prev" title="Installation"><img class="previous-page" src="_static/images/chevron-right-teal.svg"/> Previous</a>
</div>
<hr/>
<div role="contentinfo">
<p>
      © Copyright 2024, Adrien Lafage and Olivier Laurent.

    </p>
</div>
<div>
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the
      Docs</a>.
  </div>
</footer>
</div>
</div>
<div class="pytorch-content-right" id="pytorch-content-right">
<div class="pytorch-right-menu" id="pytorch-right-menu">
<div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
<ul>
<li><a class="reference internal" href="#">Quickstart</a><ul>
<li><a class="reference internal" href="#training-with-torchuncertainty-s-uncertainty-aware-routines">Training with TorchUncertainty’s Uncertainty-aware Routines</a><ul>
<li><a class="reference internal" href="#building-your-first-routine">Building your First Routine</a></li>
<li><a class="reference internal" href="#training-with-the-routine">Training with the Routine</a></li>
<li><a class="reference internal" href="#more-metrics">More metrics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-lightning-cli-tool">Using the Lightning CLI tool</a><ul>
<li><a class="reference internal" href="#procedure">Procedure</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-pytorch-based-models">Using the PyTorch-based models</a><ul>
<li><a class="reference internal" href="#id1">Procedure</a></li>
<li><a class="reference internal" href="#id2">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-pytorch-based-layers">Using the PyTorch-based layers</a><ul>
<li><a class="reference internal" href="#id3">Procedure</a></li>
<li><a class="reference internal" href="#id4">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-usage">Other usage</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</section>
</div>
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js" type="text/javascript"></script>
<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
<script src="_static/jquery.js"></script>
<script src="_static/underscore.js"></script>
<script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
<script src="_static/doctools.js"></script>
<script src="_static/sphinx_highlight.js"></script>
<script src="_static/clipboard.min.js"></script>
<script src="_static/copybutton.js"></script>
<script src="_static/js/vendor/popper.min.js" type="text/javascript"></script>
<script src="_static/js/vendor/bootstrap.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
<script src="_static/js/theme.js" type="text/javascript"></script>
<script type="text/javascript">
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
<!-- Begin Footer -->
<div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
</div>
<!-- End Footer -->
<!-- Begin Mobile Menu -->
<div class="mobile-main-menu">
<div class="container-fluid">
<div class="container">
<div class="mobile-main-menu-header-container">
<a aria-label="OpenMMLab" class="header-logo" href="https://torch-uncertainty.github.io/"></a>
<a class="main-menu-close-button" data-behavior="close-mobile-menu" href="#"></a>
</div>
</div>
</div>
<div class="mobile-main-menu-links-container">
<div class="main-menu">
<ul>
<li>
<a href="https://github.com/ENSTA-U2IS-AI/torch-uncertainty" target="_blank">GitHub</a>
</li>
</ul></div>
</div>
</div>
<!-- End Mobile Menu -->
<script src="_static/js/vendor/anchor.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function () {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function (e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>