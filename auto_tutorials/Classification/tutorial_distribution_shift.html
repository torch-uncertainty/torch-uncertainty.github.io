
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Evaluating Model Performance Under Distribution Shift with TorchUncertainty &#8212; TorchUncertainty 0.7.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-codeautolink.css?v=b2176991" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=fe7df9b0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'auto_tutorials/Classification/tutorial_distribution_shift';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Deep Evidential Classification on a Toy Example" href="tutorial_evidential_classification.html" />
    <link rel="prev" title="Training a LeNet for Image Classification with TorchUncertainty" href="tutorial_classification.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="TorchUncertainty Logo"/>
    <img src="../../_static/logo_dark.png" class="logo__image only-dark pst-js-only" alt="TorchUncertainty Logo"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../cli_guide.html">
    CLI Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API Reference
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../contributing.html">
    Contributing
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../../references.html">
    References
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ENSTA-U2IS-AI/torch-uncertainty" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../quickstart.html">
    Quickstart
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../cli_guide.html">
    CLI Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api.html">
    API Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../contributing.html">
    Contributing
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../references.html">
    References
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ENSTA-U2IS-AI/torch-uncertainty" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Classification</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial_classification.html">Training a LeNet for Image Classification with TorchUncertainty</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Evaluating Model Performance Under Distribution Shift with TorchUncertainty</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_evidential_classification.html">Deep Evidential Classification on a Toy Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_ood_detection.html">Out-of-distribution detection with TorchUncertainty</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_pe_cifar10.html">From a Standard Classifier to a Packed-Ensemble</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Regression/index.html">Regression with Uncertainty</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Regression/tutorial_der_cubic.html">Deep Evidential Regression on a Toy Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Regression/tutorial_probabilistic_regression.html">Deep Probabilistic Regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Regression/tutorial_regression.html">Training an MLP for Tabular Regression with TorchUncertainty</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Post_Hoc_Methods/index.html">Post-hoc Methods</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Post_Hoc_Methods/tutorial_conformal.html">Conformal Prediction on CIFAR-10 with TorchUncertainty</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Post_Hoc_Methods/tutorial_scaler.html">Improve Top-label Calibration with Temperature Scaling</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Bayesian_Methods/index.html">Bayesian Methods</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Bayesian_Methods/tutorial_bayesian.html">Training a Bayesian Neural Network in 20 seconds</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Bayesian_Methods/tutorial_mc_batch_norm.html">Training a LeNet with Monte Carlo Batch Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Bayesian_Methods/tutorial_mc_dropout.html">Training a LeNet with Monte-Carlo Dropout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Bayesian_Methods/tutorial_muad_mc_drop.html">Monte Carlo Dropout for Semantic Segmentation on MUAD</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Ensemble_Methods/index.html">Ensemble Methods</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Ensemble_Methods/tutorial_from_de_to_pe.html">Improved Ensemble parameter-efficiency with Packed-Ensembles</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Segmentation/index.html">Segmentation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Segmentation/tutorial_muad_deep_en.html">Deep ensembles Segmentation Tutorial using Muad Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Segmentation/tutorial_muad_packed.html">Packed ensembles Segmentation Tutorial using Muad Dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Segmentation/tutorial_muad_seg.html">Segmentation Tutorial using Muad Dataset</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Data_Augmentation/index.html">Data Augmentation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Data_Augmentation/tutorial_corruption.html">Corrupting Images with TorchUncertainty to Benchmark Robustness</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">Tutorials</a></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Classification</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Evaluating Model Performance Under Distribution Shift with TorchUncertainty</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-tutorials-classification-tutorial-distribution-shift-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="evaluating-model-performance-under-distribution-shift-with-torchuncertainty">
<span id="sphx-glr-auto-tutorials-classification-tutorial-distribution-shift-py"></span><h1>Evaluating Model Performance Under Distribution Shift with TorchUncertainty<a class="headerlink" href="#evaluating-model-performance-under-distribution-shift-with-torchuncertainty" title="Link to this heading">#</a></h1>
<p>In this tutorial, we explore how to assess a model’s robustness when faced with distribution shifts.
Specifically, we will:</p>
<ul class="simple">
<li><p>Shortly train a <strong>ResNet18</strong> model on the standard <strong>CIFAR-10</strong> dataset.</p></li>
<li><p>Evaluate its performance on both the original CIFAR-10 test set and a corrupted version of CIFAR-10 to simulate distribution shift.</p></li>
<li><p>Analyze the model’s performance and robustness under these conditions.</p></li>
</ul>
<p>By the end of this tutorial, you will understand how to use TorchUncertainty to evaluate and interpret model behavior under distribution shifts.</p>
<section id="imports-and-setup">
<h2>Imports and Setup<a class="headerlink" href="#imports-and-setup" title="Link to this heading">#</a></h2>
<p>First, we need to import the necessary libraries and set up our environment.
This includes importing PyTorch, TorchUncertainty components, and TorchUncertainty’s Trainer (built on top of Lightning’s).</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">torch</span><span class="w"> </span><span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">optim</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">torch_uncertainty</span><span class="w"> </span><span class="kn">import</span> <span class="n">TUTrainer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch_uncertainty.datamodules</span><span class="w"> </span><span class="kn">import</span> <span class="n">CIFAR10DataModule</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch_uncertainty.models.classification.resnet</span><span class="w"> </span><span class="kn">import</span> <span class="n">resnet</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch_uncertainty.routines.classification</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClassificationRoutine</span>
</pre></div>
</div>
</section>
<section id="datamodule-setup">
<h2>DataModule Setup<a class="headerlink" href="#datamodule-setup" title="Link to this heading">#</a></h2>
<p>TorchUncertainty provides convenient DataModules for standard datasets like CIFAR-10.
DataModules handle data loading, preprocessing, and batching, simplifying the data pipeline. Each datamodule
also include the corresponding out-of-distribution and distribution shift datasets, which are then used by the routine.
For CIFAR-10, the corresponding distribution-shift dataset is CIFAR-10C as used in the community.
To enable Distribution Shift evaluation, activate the <cite>eval_shift</cite> flag as done below.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the CIFAR-10 DataModule</span>
<span class="n">datamodule</span> <span class="o">=</span> <span class="n">CIFAR10DataModule</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="s2">&quot;./data&quot;</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">eval_shift</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">shift_severity</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Set severity level of the corruption (1 to 5): max-strength!</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="cifar-10c">
<h2>CIFAR-10C<a class="headerlink" href="#cifar-10c" title="Link to this heading">#</a></h2>
<p>CIFAR-10C is a transformed version of CIFAR-10 test set. Dan Hendrycks and Thomas Dietterich applied computer vision
transforms, known as corruptions to degrade the quality of the image and test deep learning models in adverse conditions.
There are 15 (+4 optional) corruptions in total, including noise, blur, weather effects, etc. Each corruption has 5 different
levels of severity ranging from small corruptions to very strong effects on the image. You can set the desired corruption level with
the shift-severity argument. We refer to [1] for more details.
You can get a more detailed overview and examples of the corruptions on the corresponding tutorial.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># These lines are usually not necessary (they are called by the Trainer),</span>
<span class="c1"># but we want to get access to the dataset before training</span>
<span class="n">datamodule</span><span class="o">.</span><span class="n">prepare_data</span><span class="p">()</span>
<span class="n">datamodule</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>

<span class="c1"># Let&#39;s check the CIFAR-10C, it should contain (15+4)*10000 images for the selected severity level.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">datamodule</span><span class="o">.</span><span class="n">shift</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>  0%|          | 0.00/170M [00:00&lt;?, ?B/s]
  0%|          | 65.5k/170M [00:00&lt;06:54, 411kB/s]
  0%|          | 229k/170M [00:00&lt;03:41, 770kB/s]
  0%|          | 655k/170M [00:00&lt;01:43, 1.63MB/s]
  1%|          | 1.47M/170M [00:00&lt;00:56, 3.01MB/s]
  2%|▏         | 3.11M/170M [00:00&lt;00:27, 6.14MB/s]
  3%|▎         | 4.46M/170M [00:00&lt;00:21, 7.67MB/s]
  5%|▍         | 7.70M/170M [00:00&lt;00:11, 14.1MB/s]
  7%|▋         | 12.0M/170M [00:01&lt;00:07, 22.0MB/s]
  9%|▉         | 15.3M/170M [00:01&lt;00:06, 23.4MB/s]
 12%|█▏        | 19.7M/170M [00:01&lt;00:05, 28.8MB/s]
 14%|█▍        | 23.8M/170M [00:01&lt;00:04, 32.2MB/s]
 16%|█▌        | 27.6M/170M [00:01&lt;00:04, 30.7MB/s]
 19%|█▊        | 31.9M/170M [00:01&lt;00:04, 34.0MB/s]
 21%|██        | 35.8M/170M [00:01&lt;00:03, 35.6MB/s]
 23%|██▎       | 39.9M/170M [00:01&lt;00:03, 33.5MB/s]
 26%|██▌       | 44.2M/170M [00:01&lt;00:03, 36.1MB/s]
 28%|██▊       | 48.5M/170M [00:02&lt;00:03, 37.8MB/s]
 31%|███       | 52.4M/170M [00:02&lt;00:03, 34.4MB/s]
 33%|███▎      | 56.5M/170M [00:02&lt;00:03, 36.1MB/s]
 36%|███▌      | 60.7M/170M [00:02&lt;00:02, 37.8MB/s]
 38%|███▊      | 64.6M/170M [00:02&lt;00:03, 34.8MB/s]
 40%|████      | 68.6M/170M [00:02&lt;00:02, 36.2MB/s]
 43%|████▎     | 72.8M/170M [00:02&lt;00:02, 37.6MB/s]
 45%|████▍     | 76.6M/170M [00:02&lt;00:02, 34.6MB/s]
 47%|████▋     | 80.7M/170M [00:02&lt;00:02, 36.4MB/s]
 50%|████▉     | 84.6M/170M [00:03&lt;00:02, 37.1MB/s]
 52%|█████▏    | 88.6M/170M [00:03&lt;00:02, 34.6MB/s]
 54%|█████▍    | 92.9M/170M [00:03&lt;00:02, 36.7MB/s]
 57%|█████▋    | 96.8M/170M [00:03&lt;00:01, 37.4MB/s]
 59%|█████▉    | 101M/170M [00:03&lt;00:02, 34.7MB/s]
 62%|██████▏   | 105M/170M [00:03&lt;00:01, 37.2MB/s]
 64%|██████▍   | 109M/170M [00:03&lt;00:01, 37.8MB/s]
 66%|██████▋   | 113M/170M [00:03&lt;00:01, 34.5MB/s]
 69%|██████▉   | 117M/170M [00:03&lt;00:01, 36.5MB/s]
 71%|███████   | 121M/170M [00:04&lt;00:01, 37.4MB/s]
 73%|███████▎  | 125M/170M [00:04&lt;00:01, 34.7MB/s]
 76%|███████▌  | 129M/170M [00:04&lt;00:01, 36.8MB/s]
 78%|███████▊  | 133M/170M [00:04&lt;00:00, 37.5MB/s]
 81%|████████  | 137M/170M [00:04&lt;00:00, 34.6MB/s]
 83%|████████▎ | 142M/170M [00:04&lt;00:00, 37.0MB/s]
 85%|████████▌ | 146M/170M [00:04&lt;00:00, 37.9MB/s]
 88%|████████▊ | 150M/170M [00:04&lt;00:00, 34.6MB/s]
 90%|█████████ | 154M/170M [00:05&lt;00:00, 37.2MB/s]
 93%|█████████▎| 158M/170M [00:05&lt;00:00, 38.8MB/s]
 95%|█████████▌| 162M/170M [00:05&lt;00:00, 35.2MB/s]
 98%|█████████▊| 167M/170M [00:05&lt;00:00, 37.1MB/s]
100%|██████████| 170M/170M [00:05&lt;00:00, 31.4MB/s]

  0%|          | 0.00/2.92G [00:00&lt;?, ?B/s]
  0%|          | 3.01M/2.92G [00:00&lt;01:36, 30.1MB/s]
  1%|          | 14.6M/2.92G [00:00&lt;00:36, 80.6MB/s]
  1%|          | 26.4M/2.92G [00:00&lt;00:29, 97.5MB/s]
  1%|▏         | 38.1M/2.92G [00:00&lt;00:27, 105MB/s]
  2%|▏         | 49.7M/2.92G [00:00&lt;00:26, 109MB/s]
  2%|▏         | 61.0M/2.92G [00:00&lt;00:25, 110MB/s]
  2%|▏         | 72.7M/2.92G [00:00&lt;00:25, 113MB/s]
  3%|▎         | 84.2M/2.92G [00:00&lt;00:25, 113MB/s]
  3%|▎         | 95.9M/2.92G [00:00&lt;00:24, 114MB/s]
  4%|▎         | 108M/2.92G [00:01&lt;00:24, 115MB/s]
  4%|▍         | 119M/2.92G [00:01&lt;00:24, 116MB/s]
  4%|▍         | 131M/2.92G [00:01&lt;00:24, 112MB/s]
  5%|▍         | 143M/2.92G [00:01&lt;00:24, 114MB/s]
  5%|▌         | 154M/2.92G [00:01&lt;00:24, 115MB/s]
  6%|▌         | 166M/2.92G [00:01&lt;00:23, 115MB/s]
  6%|▌         | 178M/2.92G [00:01&lt;00:23, 116MB/s]
  6%|▋         | 190M/2.92G [00:01&lt;00:23, 117MB/s]
  7%|▋         | 201M/2.92G [00:01&lt;00:23, 117MB/s]
  7%|▋         | 213M/2.92G [00:01&lt;00:23, 117MB/s]
  8%|▊         | 225M/2.92G [00:02&lt;00:23, 117MB/s]
  8%|▊         | 237M/2.92G [00:02&lt;00:22, 117MB/s]
  9%|▊         | 248M/2.92G [00:02&lt;00:22, 117MB/s]
  9%|▉         | 260M/2.92G [00:02&lt;00:22, 117MB/s]
  9%|▉         | 272M/2.92G [00:02&lt;00:22, 117MB/s]
 10%|▉         | 283M/2.92G [00:02&lt;00:23, 114MB/s]
 10%|█         | 295M/2.92G [00:02&lt;00:23, 113MB/s]
 10%|█         | 306M/2.92G [00:02&lt;00:23, 113MB/s]
 11%|█         | 318M/2.92G [00:02&lt;00:22, 114MB/s]
 11%|█▏        | 329M/2.92G [00:02&lt;00:23, 110MB/s]
 12%|█▏        | 340M/2.92G [00:03&lt;00:24, 107MB/s]
 12%|█▏        | 351M/2.92G [00:03&lt;00:24, 105MB/s]
 12%|█▏        | 362M/2.92G [00:03&lt;00:24, 104MB/s]
 13%|█▎        | 372M/2.92G [00:03&lt;00:24, 103MB/s]
 13%|█▎        | 382M/2.92G [00:03&lt;00:24, 102MB/s]
 13%|█▎        | 393M/2.92G [00:03&lt;00:24, 102MB/s]
 14%|█▍        | 403M/2.92G [00:03&lt;00:24, 102MB/s]
 14%|█▍        | 413M/2.92G [00:03&lt;00:24, 103MB/s]
 15%|█▍        | 424M/2.92G [00:03&lt;00:24, 104MB/s]
 15%|█▍        | 435M/2.92G [00:03&lt;00:23, 105MB/s]
 15%|█▌        | 445M/2.92G [00:04&lt;00:23, 106MB/s]
 16%|█▌        | 456M/2.92G [00:04&lt;00:23, 106MB/s]
 16%|█▌        | 467M/2.92G [00:04&lt;00:22, 107MB/s]
 16%|█▋        | 478M/2.92G [00:04&lt;00:22, 107MB/s]
 17%|█▋        | 489M/2.92G [00:04&lt;00:22, 108MB/s]
 17%|█▋        | 500M/2.92G [00:04&lt;00:22, 108MB/s]
 17%|█▋        | 511M/2.92G [00:04&lt;00:23, 104MB/s]
 18%|█▊        | 522M/2.92G [00:04&lt;00:22, 107MB/s]
 18%|█▊        | 534M/2.92G [00:04&lt;00:21, 110MB/s]
 19%|█▊        | 545M/2.92G [00:04&lt;00:21, 111MB/s]
 19%|█▉        | 557M/2.92G [00:05&lt;00:21, 112MB/s]
 19%|█▉        | 568M/2.92G [00:05&lt;00:20, 113MB/s]
 20%|█▉        | 580M/2.92G [00:05&lt;00:20, 114MB/s]
 20%|██        | 591M/2.92G [00:05&lt;00:20, 115MB/s]
 21%|██        | 603M/2.92G [00:05&lt;00:20, 115MB/s]
 21%|██        | 615M/2.92G [00:05&lt;00:20, 115MB/s]
 21%|██▏       | 626M/2.92G [00:05&lt;00:19, 115MB/s]
 22%|██▏       | 638M/2.92G [00:05&lt;00:19, 116MB/s]
 22%|██▏       | 650M/2.92G [00:05&lt;00:19, 116MB/s]
 23%|██▎       | 662M/2.92G [00:05&lt;00:19, 116MB/s]
 23%|██▎       | 673M/2.92G [00:06&lt;00:19, 116MB/s]
 23%|██▎       | 685M/2.92G [00:06&lt;00:19, 116MB/s]
 24%|██▍       | 697M/2.92G [00:06&lt;00:19, 117MB/s]
 24%|██▍       | 709M/2.92G [00:06&lt;00:18, 117MB/s]
 25%|██▍       | 720M/2.92G [00:06&lt;00:18, 117MB/s]
 25%|██▌       | 732M/2.92G [00:06&lt;00:18, 117MB/s]
 25%|██▌       | 744M/2.92G [00:06&lt;00:18, 117MB/s]
 26%|██▌       | 755M/2.92G [00:06&lt;00:18, 117MB/s]
 26%|██▋       | 767M/2.92G [00:06&lt;00:18, 117MB/s]
 27%|██▋       | 779M/2.92G [00:06&lt;00:18, 117MB/s]
 27%|██▋       | 791M/2.92G [00:07&lt;00:18, 117MB/s]
 27%|██▋       | 802M/2.92G [00:07&lt;00:18, 117MB/s]
 28%|██▊       | 814M/2.92G [00:07&lt;00:18, 116MB/s]
 28%|██▊       | 826M/2.92G [00:07&lt;00:17, 116MB/s]
 29%|██▊       | 838M/2.92G [00:07&lt;00:17, 117MB/s]
 29%|██▉       | 849M/2.92G [00:07&lt;00:18, 115MB/s]
 29%|██▉       | 861M/2.92G [00:07&lt;00:18, 112MB/s]
 30%|██▉       | 872M/2.92G [00:07&lt;00:19, 107MB/s]
 30%|███       | 883M/2.92G [00:07&lt;00:19, 104MB/s]
 31%|███       | 893M/2.92G [00:08&lt;00:19, 104MB/s]
 31%|███       | 904M/2.92G [00:08&lt;00:19, 102MB/s]
 31%|███▏      | 914M/2.92G [00:08&lt;00:19, 102MB/s]
 32%|███▏      | 924M/2.92G [00:08&lt;00:19, 103MB/s]
 32%|███▏      | 935M/2.92G [00:08&lt;00:19, 104MB/s]
 32%|███▏      | 946M/2.92G [00:08&lt;00:18, 105MB/s]
 33%|███▎      | 957M/2.92G [00:08&lt;00:18, 106MB/s]
 33%|███▎      | 968M/2.92G [00:08&lt;00:18, 107MB/s]
 34%|███▎      | 979M/2.92G [00:08&lt;00:18, 108MB/s]
 34%|███▍      | 990M/2.92G [00:08&lt;00:17, 108MB/s]
 34%|███▍      | 1.00G/2.92G [00:09&lt;00:17, 111MB/s]
 35%|███▍      | 1.01G/2.92G [00:09&lt;00:17, 112MB/s]
 35%|███▌      | 1.02G/2.92G [00:09&lt;00:16, 112MB/s]
 35%|███▌      | 1.04G/2.92G [00:09&lt;00:16, 113MB/s]
 36%|███▌      | 1.05G/2.92G [00:09&lt;00:16, 114MB/s]
 36%|███▋      | 1.06G/2.92G [00:09&lt;00:16, 114MB/s]
 37%|███▋      | 1.07G/2.92G [00:09&lt;00:16, 115MB/s]
 37%|███▋      | 1.08G/2.92G [00:09&lt;00:16, 111MB/s]
 37%|███▋      | 1.09G/2.92G [00:09&lt;00:16, 113MB/s]
 38%|███▊      | 1.11G/2.92G [00:09&lt;00:15, 114MB/s]
 38%|███▊      | 1.12G/2.92G [00:10&lt;00:15, 115MB/s]
 39%|███▊      | 1.13G/2.92G [00:10&lt;00:15, 114MB/s]
 39%|███▉      | 1.14G/2.92G [00:10&lt;00:15, 115MB/s]
 39%|███▉      | 1.15G/2.92G [00:10&lt;00:15, 116MB/s]
 40%|███▉      | 1.16G/2.92G [00:10&lt;00:15, 116MB/s]
 40%|████      | 1.18G/2.92G [00:10&lt;00:15, 115MB/s]
 41%|████      | 1.19G/2.92G [00:10&lt;00:15, 115MB/s]
 41%|████      | 1.20G/2.92G [00:10&lt;00:14, 116MB/s]
 41%|████▏     | 1.21G/2.92G [00:10&lt;00:14, 116MB/s]
 42%|████▏     | 1.22G/2.92G [00:10&lt;00:14, 117MB/s]
 42%|████▏     | 1.23G/2.92G [00:11&lt;00:14, 116MB/s]
 43%|████▎     | 1.25G/2.92G [00:11&lt;00:14, 116MB/s]
 43%|████▎     | 1.26G/2.92G [00:11&lt;00:14, 116MB/s]
 44%|████▎     | 1.27G/2.92G [00:11&lt;00:14, 117MB/s]
 44%|████▍     | 1.28G/2.92G [00:11&lt;00:14, 117MB/s]
 44%|████▍     | 1.29G/2.92G [00:11&lt;00:14, 116MB/s]
 45%|████▍     | 1.30G/2.92G [00:11&lt;00:13, 116MB/s]
 45%|████▌     | 1.32G/2.92G [00:11&lt;00:13, 117MB/s]
 46%|████▌     | 1.33G/2.92G [00:11&lt;00:13, 117MB/s]
 46%|████▌     | 1.34G/2.92G [00:11&lt;00:13, 116MB/s]
 46%|████▋     | 1.35G/2.92G [00:12&lt;00:13, 116MB/s]
 47%|████▋     | 1.36G/2.92G [00:12&lt;00:13, 117MB/s]
 47%|████▋     | 1.38G/2.92G [00:12&lt;00:13, 117MB/s]
 48%|████▊     | 1.39G/2.92G [00:12&lt;00:13, 113MB/s]
 48%|████▊     | 1.40G/2.92G [00:12&lt;00:13, 113MB/s]
 48%|████▊     | 1.41G/2.92G [00:12&lt;00:13, 114MB/s]
 49%|████▊     | 1.42G/2.92G [00:12&lt;00:12, 115MB/s]
 49%|████▉     | 1.43G/2.92G [00:12&lt;00:12, 116MB/s]
 50%|████▉     | 1.45G/2.92G [00:12&lt;00:12, 116MB/s]
 50%|████▉     | 1.46G/2.92G [00:13&lt;00:12, 113MB/s]
 50%|█████     | 1.47G/2.92G [00:13&lt;00:12, 114MB/s]
 51%|█████     | 1.48G/2.92G [00:13&lt;00:12, 115MB/s]
 51%|█████     | 1.49G/2.92G [00:13&lt;00:12, 116MB/s]
 52%|█████▏    | 1.50G/2.92G [00:13&lt;00:12, 115MB/s]
 52%|█████▏    | 1.52G/2.92G [00:13&lt;00:12, 116MB/s]
 52%|█████▏    | 1.53G/2.92G [00:13&lt;00:11, 116MB/s]
 53%|█████▎    | 1.54G/2.92G [00:13&lt;00:11, 117MB/s]
 53%|█████▎    | 1.55G/2.92G [00:13&lt;00:11, 115MB/s]
 54%|█████▎    | 1.56G/2.92G [00:13&lt;00:11, 116MB/s]
 54%|█████▍    | 1.57G/2.92G [00:14&lt;00:11, 116MB/s]
 54%|█████▍    | 1.59G/2.92G [00:14&lt;00:11, 117MB/s]
 55%|█████▍    | 1.60G/2.92G [00:14&lt;00:11, 117MB/s]
 55%|█████▌    | 1.61G/2.92G [00:14&lt;00:11, 116MB/s]
 56%|█████▌    | 1.62G/2.92G [00:14&lt;00:11, 117MB/s]
 56%|█████▌    | 1.63G/2.92G [00:14&lt;00:10, 117MB/s]
 56%|█████▋    | 1.65G/2.92G [00:14&lt;00:10, 117MB/s]
 57%|█████▋    | 1.66G/2.92G [00:14&lt;00:10, 116MB/s]
 57%|█████▋    | 1.67G/2.92G [00:14&lt;00:10, 116MB/s]
 58%|█████▊    | 1.68G/2.92G [00:14&lt;00:10, 117MB/s]
 58%|█████▊    | 1.69G/2.92G [00:15&lt;00:10, 117MB/s]
 58%|█████▊    | 1.70G/2.92G [00:15&lt;00:10, 117MB/s]
 59%|█████▉    | 1.72G/2.92G [00:15&lt;00:10, 116MB/s]
 59%|█████▉    | 1.73G/2.92G [00:15&lt;00:10, 117MB/s]
 60%|█████▉    | 1.74G/2.92G [00:15&lt;00:10, 117MB/s]
 60%|█████▉    | 1.75G/2.92G [00:15&lt;00:09, 117MB/s]
 60%|██████    | 1.76G/2.92G [00:15&lt;00:09, 116MB/s]
 61%|██████    | 1.77G/2.92G [00:15&lt;00:09, 115MB/s]
 61%|██████    | 1.79G/2.92G [00:15&lt;00:09, 116MB/s]
 62%|██████▏   | 1.80G/2.92G [00:15&lt;00:09, 116MB/s]
 62%|██████▏   | 1.81G/2.92G [00:16&lt;00:09, 116MB/s]
 62%|██████▏   | 1.82G/2.92G [00:16&lt;00:09, 116MB/s]
 63%|██████▎   | 1.83G/2.92G [00:16&lt;00:09, 116MB/s]
 63%|██████▎   | 1.84G/2.92G [00:16&lt;00:09, 117MB/s]
 64%|██████▎   | 1.86G/2.92G [00:16&lt;00:09, 115MB/s]
 64%|██████▍   | 1.87G/2.92G [00:16&lt;00:09, 115MB/s]
 64%|██████▍   | 1.88G/2.92G [00:16&lt;00:09, 115MB/s]
 65%|██████▍   | 1.89G/2.92G [00:16&lt;00:08, 115MB/s]
 65%|██████▌   | 1.90G/2.92G [00:16&lt;00:08, 115MB/s]
 66%|██████▌   | 1.91G/2.92G [00:16&lt;00:08, 116MB/s]
 66%|██████▌   | 1.93G/2.92G [00:17&lt;00:08, 115MB/s]
 66%|██████▋   | 1.94G/2.92G [00:17&lt;00:08, 116MB/s]
 67%|██████▋   | 1.95G/2.92G [00:17&lt;00:08, 116MB/s]
 67%|██████▋   | 1.96G/2.92G [00:17&lt;00:08, 113MB/s]
 68%|██████▊   | 1.97G/2.92G [00:17&lt;00:10, 93.7MB/s]
 68%|██████▊   | 1.98G/2.92G [00:17&lt;00:11, 81.8MB/s]
 68%|██████▊   | 1.99G/2.92G [00:17&lt;00:12, 76.6MB/s]
 68%|██████▊   | 2.00G/2.92G [00:17&lt;00:12, 73.2MB/s]
 69%|██████▉   | 2.01G/2.92G [00:18&lt;00:12, 70.2MB/s]
 69%|██████▉   | 2.01G/2.92G [00:18&lt;00:13, 69.3MB/s]
 69%|██████▉   | 2.02G/2.92G [00:18&lt;00:13, 68.3MB/s]
 69%|██████▉   | 2.03G/2.92G [00:18&lt;00:13, 67.6MB/s]
 70%|██████▉   | 2.03G/2.92G [00:18&lt;00:12, 68.2MB/s]
 70%|██████▉   | 2.04G/2.92G [00:18&lt;00:12, 69.2MB/s]
 70%|███████   | 2.05G/2.92G [00:18&lt;00:12, 69.9MB/s]
 70%|███████   | 2.06G/2.92G [00:18&lt;00:12, 70.4MB/s]
 71%|███████   | 2.06G/2.92G [00:18&lt;00:12, 70.9MB/s]
 71%|███████   | 2.07G/2.92G [00:18&lt;00:11, 71.2MB/s]
 71%|███████   | 2.08G/2.92G [00:19&lt;00:11, 71.5MB/s]
 71%|███████▏  | 2.09G/2.92G [00:19&lt;00:11, 71.9MB/s]
 72%|███████▏  | 2.09G/2.92G [00:19&lt;00:11, 73.6MB/s]
 72%|███████▏  | 2.10G/2.92G [00:19&lt;00:11, 74.3MB/s]
 72%|███████▏  | 2.11G/2.92G [00:19&lt;00:10, 75.6MB/s]
 73%|███████▎  | 2.12G/2.92G [00:19&lt;00:10, 77.0MB/s]
 73%|███████▎  | 2.12G/2.92G [00:19&lt;00:10, 77.9MB/s]
 73%|███████▎  | 2.13G/2.92G [00:19&lt;00:10, 78.4MB/s]
 73%|███████▎  | 2.14G/2.92G [00:19&lt;00:09, 78.7MB/s]
 74%|███████▎  | 2.15G/2.92G [00:19&lt;00:09, 78.9MB/s]
 74%|███████▍  | 2.16G/2.92G [00:20&lt;00:09, 80.5MB/s]
 74%|███████▍  | 2.17G/2.92G [00:20&lt;00:09, 82.2MB/s]
 75%|███████▍  | 2.17G/2.92G [00:20&lt;00:08, 83.4MB/s]
 75%|███████▍  | 2.18G/2.92G [00:20&lt;00:08, 83.6MB/s]
 75%|███████▌  | 2.19G/2.92G [00:20&lt;00:08, 84.5MB/s]
 75%|███████▌  | 2.20G/2.92G [00:20&lt;00:08, 85.3MB/s]
 76%|███████▌  | 2.21G/2.92G [00:20&lt;00:08, 85.8MB/s]
 76%|███████▌  | 2.22G/2.92G [00:20&lt;00:08, 86.4MB/s]
 76%|███████▋  | 2.23G/2.92G [00:20&lt;00:07, 88.0MB/s]
 77%|███████▋  | 2.24G/2.92G [00:20&lt;00:07, 89.6MB/s]
 77%|███████▋  | 2.25G/2.92G [00:21&lt;00:07, 90.7MB/s]
 77%|███████▋  | 2.25G/2.92G [00:21&lt;00:07, 91.0MB/s]
 78%|███████▊  | 2.26G/2.92G [00:21&lt;00:07, 92.1MB/s]
 78%|███████▊  | 2.27G/2.92G [00:21&lt;00:06, 92.5MB/s]
 78%|███████▊  | 2.28G/2.92G [00:21&lt;00:06, 92.9MB/s]
 79%|███████▊  | 2.29G/2.92G [00:21&lt;00:06, 93.3MB/s]
 79%|███████▉  | 2.30G/2.92G [00:21&lt;00:06, 95.2MB/s]
 79%|███████▉  | 2.31G/2.92G [00:21&lt;00:06, 96.8MB/s]
 80%|███████▉  | 2.32G/2.92G [00:21&lt;00:06, 97.7MB/s]
 80%|███████▉  | 2.33G/2.92G [00:21&lt;00:05, 98.4MB/s]
 80%|████████  | 2.34G/2.92G [00:22&lt;00:05, 99.4MB/s]
 81%|████████  | 2.35G/2.92G [00:22&lt;00:05, 99.8MB/s]
 81%|████████  | 2.36G/2.92G [00:22&lt;00:05, 96.2MB/s]
 81%|████████▏ | 2.37G/2.92G [00:22&lt;00:06, 90.7MB/s]
 82%|████████▏ | 2.38G/2.92G [00:22&lt;00:06, 84.9MB/s]
 82%|████████▏ | 2.39G/2.92G [00:22&lt;00:06, 79.8MB/s]
 82%|████████▏ | 2.40G/2.92G [00:22&lt;00:06, 79.5MB/s]
 82%|████████▏ | 2.41G/2.92G [00:22&lt;00:06, 79.7MB/s]
 83%|████████▎ | 2.41G/2.92G [00:22&lt;00:06, 79.8MB/s]
 83%|████████▎ | 2.42G/2.92G [00:23&lt;00:06, 79.7MB/s]
 83%|████████▎ | 2.43G/2.92G [00:23&lt;00:06, 79.7MB/s]
 84%|████████▎ | 2.44G/2.92G [00:23&lt;00:06, 79.3MB/s]
 84%|████████▍ | 2.45G/2.92G [00:23&lt;00:05, 80.0MB/s]
 84%|████████▍ | 2.46G/2.92G [00:23&lt;00:05, 81.5MB/s]
 84%|████████▍ | 2.46G/2.92G [00:23&lt;00:05, 82.9MB/s]
 85%|████████▍ | 2.47G/2.92G [00:23&lt;00:05, 82.8MB/s]
 85%|████████▌ | 2.48G/2.92G [00:23&lt;00:05, 84.2MB/s]
 85%|████████▌ | 2.49G/2.92G [00:23&lt;00:05, 85.1MB/s]
 86%|████████▌ | 2.50G/2.92G [00:23&lt;00:04, 85.8MB/s]
 86%|████████▌ | 2.51G/2.92G [00:24&lt;00:04, 86.2MB/s]
 86%|████████▌ | 2.52G/2.92G [00:24&lt;00:04, 86.3MB/s]
 87%|████████▋ | 2.52G/2.92G [00:24&lt;00:04, 86.6MB/s]
 87%|████████▋ | 2.53G/2.92G [00:24&lt;00:04, 87.2MB/s]
 87%|████████▋ | 2.54G/2.92G [00:24&lt;00:04, 89.7MB/s]
 87%|████████▋ | 2.55G/2.92G [00:24&lt;00:04, 90.7MB/s]
 88%|████████▊ | 2.56G/2.92G [00:24&lt;00:03, 91.7MB/s]
 88%|████████▊ | 2.57G/2.92G [00:24&lt;00:03, 92.2MB/s]
 88%|████████▊ | 2.58G/2.92G [00:24&lt;00:03, 92.5MB/s]
 89%|████████▊ | 2.59G/2.92G [00:24&lt;00:03, 92.8MB/s]
 89%|████████▉ | 2.60G/2.92G [00:25&lt;00:03, 93.0MB/s]
 89%|████████▉ | 2.61G/2.92G [00:25&lt;00:03, 93.7MB/s]
 90%|████████▉ | 2.62G/2.92G [00:25&lt;00:03, 95.4MB/s]
 90%|█████████ | 2.63G/2.92G [00:25&lt;00:02, 96.8MB/s]
 90%|█████████ | 2.64G/2.92G [00:25&lt;00:02, 98.1MB/s]
 91%|█████████ | 2.65G/2.92G [00:25&lt;00:02, 98.7MB/s]
 91%|█████████ | 2.66G/2.92G [00:25&lt;00:02, 99.5MB/s]
 91%|█████████▏| 2.67G/2.92G [00:25&lt;00:02, 100MB/s]
 92%|█████████▏| 2.68G/2.92G [00:25&lt;00:02, 100MB/s]
 92%|█████████▏| 2.69G/2.92G [00:25&lt;00:02, 101MB/s]
 93%|█████████▎| 2.70G/2.92G [00:26&lt;00:02, 103MB/s]
 93%|█████████▎| 2.71G/2.92G [00:26&lt;00:01, 104MB/s]
 93%|█████████▎| 2.72G/2.92G [00:26&lt;00:01, 105MB/s]
 94%|█████████▎| 2.73G/2.92G [00:26&lt;00:01, 106MB/s]
 94%|█████████▍| 2.74G/2.92G [00:26&lt;00:01, 106MB/s]
 94%|█████████▍| 2.75G/2.92G [00:26&lt;00:01, 107MB/s]
 95%|█████████▍| 2.77G/2.92G [00:26&lt;00:01, 107MB/s]
 95%|█████████▌| 2.78G/2.92G [00:26&lt;00:01, 108MB/s]
 96%|█████████▌| 2.79G/2.92G [00:26&lt;00:01, 110MB/s]
 96%|█████████▌| 2.80G/2.92G [00:26&lt;00:01, 111MB/s]
 96%|█████████▋| 2.81G/2.92G [00:27&lt;00:00, 112MB/s]
 97%|█████████▋| 2.82G/2.92G [00:27&lt;00:00, 113MB/s]
 97%|█████████▋| 2.83G/2.92G [00:27&lt;00:00, 111MB/s]
 97%|█████████▋| 2.84G/2.92G [00:27&lt;00:00, 111MB/s]
 98%|█████████▊| 2.86G/2.92G [00:27&lt;00:00, 113MB/s]
 98%|█████████▊| 2.87G/2.92G [00:27&lt;00:00, 113MB/s]
 99%|█████████▊| 2.88G/2.92G [00:27&lt;00:00, 114MB/s]
 99%|█████████▉| 2.89G/2.92G [00:27&lt;00:00, 115MB/s]
 99%|█████████▉| 2.90G/2.92G [00:27&lt;00:00, 116MB/s]
100%|█████████▉| 2.91G/2.92G [00:28&lt;00:00, 116MB/s]
100%|██████████| 2.92G/2.92G [00:28&lt;00:00, 104MB/s]
Dataset CIFAR10C
    Number of datapoints: 190000
    Root location: data/CIFAR-10-C
    StandardTransform
Transform: Compose(
                 ToImage()
                 ToDtype(scale=True)
                 Normalize(mean=[0.4914, 0.4822, 0.4465], std=[0.2023, 0.1994, 0.201], inplace=False)
           )
</pre></div>
</div>
</section>
<section id="model-initialization">
<h2>Model Initialization<a class="headerlink" href="#model-initialization" title="Link to this heading">#</a></h2>
<p>We will use the ResNet18 architecture, a widely adopted convolutional neural network known for its deep residual learning capabilities.
The model is initialized with 10 output classes corresponding to the CIFAR-10 dataset categories.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the ResNet18 model with 10 output classes</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">resnet</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">in_channels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="define-the-classification-routine">
<h2>Define the Classification Routine<a class="headerlink" href="#define-the-classification-routine" title="Link to this heading">#</a></h2>
<p>The <cite>ClassificationRoutine</cite> is one of the most crucial building blocks in TorchUncertainty.
It streamlines the training and evaluation processes.
It integrates the model, loss function, and optimizer into a cohesive routine compatible with PyTorch Lightning’s Trainer.
This abstraction simplifies the implementation of standard training loops and evaluation protocols.
To come back to what matters in this tutorial, the routine also handles the evaluation of the performance
of the model under distribution shift detection. To enable it, activate the <cite>eval_shift</cite> flag. Note that you can also evaluate
the Out-of-distribution detection at the same time by also setting <cite>eval_ood</cite> to True.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the loss function: Cross-Entropy Loss for multi-class classification</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>

<span class="c1"># Define the optimizer: Adam optimizer with a learning rate of 0.001</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

<span class="c1"># Initialize the ClassificationRoutine with the model, number of classes, loss function, and optimizer</span>
<span class="n">routine</span> <span class="o">=</span> <span class="n">ClassificationRoutine</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span> <span class="n">optim_recipe</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">eval_shift</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="training-the-model">
<h2>Training the Model<a class="headerlink" href="#training-the-model" title="Link to this heading">#</a></h2>
<p>With the routine defined, we can now set up the TUTrainer and commence training.
The TUTrainer handles the training loop, including epoch management, logging, and checkpointing.
We specify the maximum number of epochs, the precision and the device to be used.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the TUTrainer with a maximum of 10 epochs and the specified device</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">TUTrainer</span><span class="p">(</span>
    <span class="n">max_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="s2">&quot;16-mixed&quot;</span><span class="p">,</span> <span class="n">accelerator</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span> <span class="n">devices</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">enable_progress_bar</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># Begin training the model using the CIFAR-10 DataModule</span>
<span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">routine</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="n">datamodule</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="evaluating-on-in-distribution-and-distribution-shifted-data">
<h2>Evaluating on In-Distribution and Distribution-shifted Data<a class="headerlink" href="#evaluating-on-in-distribution-and-distribution-shifted-data" title="Link to this heading">#</a></h2>
<p>Now that the model is trained, we can evaluate its performance on the original in-distribution test set,
as well as the distribution-shifted set. Typing the next line will automatically compute the in-distribution
metrics as well as their values on the distribution-shifted set.</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluate the trained model on the original CIFAR-10 test set and on CIFAR-10C</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">routine</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="n">datamodule</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Test metric  ┃      Classification       ┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│     Acc      │          74.830%          │
│    Brier     │          0.35181          │
│   Entropy    │          0.55485          │
│     NLL      │          0.74359          │
└──────────────┴───────────────────────────┘
┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Test metric  ┃        Calibration        ┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│     ECE      │          5.476%           │
│     aECE     │          5.459%           │
└──────────────┴───────────────────────────┘
┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Test metric  ┃ Selective Classification  ┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│    AUGRC     │          6.392%           │
│     AURC     │          8.623%           │
│  Cov@5Risk   │           nan%            │
│  Risk@80Cov  │          16.550%          │
└──────────────┴───────────────────────────┘
┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Test metric  ┃  Distribution Shift lvl5  ┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│    AUGRC     │          7.868%           │
│     AURC     │          10.876%          │
│     Acc      │          71.484%          │
│    Brier     │          0.39846          │
│  Cov@5Risk   │           nan%            │
│     ECE      │          7.186%           │
│     NLL      │          0.85908          │
│  Risk@80Cov  │          20.079%          │
│     aECE     │          7.182%           │
└──────────────┴───────────────────────────┘
┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Test metric  ┃        Complexity         ┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│    flops     │          37.90 G          │
│    params    │          11.18 M          │
└──────────────┴───────────────────────────┘
</pre></div>
</div>
</section>
<section id="distribution-shift-metrics">
<h2>Distribution-shift metrics<a class="headerlink" href="#distribution-shift-metrics" title="Link to this heading">#</a></h2>
<p>The distribution shift metrics are computed only when the <cite>eval_shift</cite> flag of the routine is True.
In this case, the values of the metrics are shown last. They correspond to the in-distribution metrics but
computed on the distribution-shifted datasets, hence the worse results.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (1 minutes 35.080 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-tutorials-classification-tutorial-distribution-shift-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/a25e4abf9a4ffd96297cfb7a66bc8ea8/tutorial_distribution_shift.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">tutorial_distribution_shift.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/d4c164317321e7fe90f219e7ee3b85a6/tutorial_distribution_shift.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">tutorial_distribution_shift.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/3d5f57d25cfa484ea72122a1a200e758/tutorial_distribution_shift.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">tutorial_distribution_shift.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="tutorial_classification.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Training a LeNet for Image Classification with TorchUncertainty</p>
      </div>
    </a>
    <a class="right-next"
       href="tutorial_evidential_classification.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Deep Evidential Classification on a Toy Example</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-and-setup">Imports and Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datamodule-setup">DataModule Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cifar-10c">CIFAR-10C</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-initialization">Model Initialization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-classification-routine">Define the Classification Routine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training-the-model">Training the Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluating-on-in-distribution-and-distribution-shifted-data">Evaluating on In-Distribution and Distribution-shifted Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-shift-metrics">Distribution-shift metrics</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/auto_tutorials/Classification/tutorial_distribution_shift.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
    <div class="footer-items__center">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Adrien Lafage and Olivier Laurent.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
</div>

  </footer>
  </body>
</html>